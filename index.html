<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¾™ä¹‹ä¹¦ è‡ªåŠ©æŒ‡ä»¤æŠ½å–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
            font-size: 2em;
        }
        
        .deck-selector {
            margin: 20px 0;
        }
        
        .deck-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .deck-btn {
            padding: 12px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .deck-btn:hover {
            background: #667eea;
            color: white;
        }
        
        .draw-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            margin: 20px 0;
            transition: transform 0.3s;
        }
        
        .draw-btn:hover:not(:disabled) {
            transform: scale(1.02);
        }
        
        .draw-btn:disabled {
            background: #cccccc;
            cursor: not-allowed;
        }
        
        .result-area {
            min-height: 100px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px dashed #ddd;
        }
        
        .result-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.5em;
            }
            
            .deck-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ² è‡ªåŠ©æŒ‡ä»¤æŠ½å–</h1>
        
        <div class="deck-selector">
            <h3>é€‰æ‹©ç‰Œå †ï¼š</h3>
            <div class="deck-grid" id="deckList">
                <!-- ç‰Œå †æŒ‰é’®ä¼šåœ¨è¿™é‡Œç”Ÿæˆ -->
            </div>
        </div>
        
        <button class="draw-btn" id="drawBtn" disabled>è¯·å…ˆé€‰æ‹©ç‰Œå †</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨æŠ½å–ä¸­...</p>
        </div>
        
        <div class="result-area" id="resultArea">
            <p style="color: #999; text-align: center;">æŠ½å¡ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ</p>
        </div>
    </div>

    <script>
        // ç‰Œå †æ•°æ® - ç¨åä» decks.json åŠ è½½
        let decks = {};
        let selectedDeck = null;
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        window.onload = async function() {
            console.log('æŠ½å¡ç³»ç»Ÿæ­£åœ¨å¯åŠ¨...');
            
            try {
                // åŠ è½½ç‰Œå †æ•°æ®
                const response = await fetch('decks.json');
                decks = await response.json();
                console.log('ç‰Œå †åŠ è½½æˆåŠŸ:', Object.keys(decks).length, 'ä¸ªç‰Œå †');
                
                // ç”Ÿæˆç‰Œå †æŒ‰é’®
                renderDeckList();
            } catch (error) {
                console.error('åŠ è½½ç‰Œå †å¤±è´¥:', error);
                // ä½¿ç”¨ç¤ºä¾‹æ•°æ®
                decks = {
                    "ç¤ºä¾‹ç‰Œå †": ["ç¤ºä¾‹å¡ç‰‡1", "ç¤ºä¾‹å¡ç‰‡2", "ç¤ºä¾‹å¡ç‰‡3"]
                };
                renderDeckList();
                alert('æ­£åœ¨ä½¿ç”¨ç¤ºä¾‹æ•°æ®ï¼Œè¯·ç¡®ä¿decks.jsonæ–‡ä»¶å­˜åœ¨');
            }
        };
        
        // ç”Ÿæˆç‰Œå †æŒ‰é’®
        function renderDeckList() {
            const deckList = document.getElementById('deckList');
            deckList.innerHTML = '';
            
            Object.keys(decks).forEach(deckName => {
                const button = document.createElement('button');
                button.className = 'deck-btn';
                button.textContent = `${deckName} (${decks[deckName].length}å¼ )`;
                button.onclick = () => selectDeck(deckName);
                deckList.appendChild(button);
            });
        }
        
        // é€‰æ‹©ç‰Œå †
        function selectDeck(deckName) {
            selectedDeck = deckName;
            
            // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.deck-btn').forEach(btn => {
                btn.style.background = 'white';
                btn.style.color = '#333';
            });
            
            // è®¾ç½®å½“å‰æŒ‰é’®ä¸ºé€‰ä¸­çŠ¶æ€
            event.target.style.background = '#667eea';
            event.target.style.color = 'white';
            
            // æ›´æ–°æŠ½å¡æŒ‰é’®
            const drawBtn = document.getElementById('drawBtn');
            drawBtn.disabled = false;
            drawBtn.textContent = `æŠ½å–ã€${deckName}ã€‘`;
        }
        
        // æŠ½å¡
        function drawCard() {
            if (!selectedDeck) return;
            
            const cards = decks[selectedDeck];
            if (cards.length === 0) return;
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            const loading = document.getElementById('loading');
            const drawBtn = document.getElementById('drawBtn');
            loading.style.display = 'block';
            drawBtn.disabled = true;
            
            // æ¨¡æ‹ŸæŠ½å¡å»¶è¿Ÿ
            setTimeout(() => {
                const randomIndex = Math.floor(Math.random() * cards.length);
                const card = cards[randomIndex];
                
                // éšè—åŠ è½½åŠ¨ç”»
                loading.style.display = 'none';
                drawBtn.disabled = false;
                
                // æ˜¾ç¤ºç»“æœ
                showResult(card);
            }, 800);
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult(card) {
            const resultArea = document.getElementById('resultArea');
            
            // åˆ›å»ºç»“æœå¡ç‰‡
            const resultCard = document.createElement('div');
            resultCard.className = 'result-card';
            resultCard.innerHTML = `
                <strong>ã€${selectedDeck}ã€‘</strong><br>
                ${card}<br>
                <small style="color: #666; display: block; margin-top: 5px;">
                    ğŸ• ${new Date().toLocaleTimeString()}
                </small>
            `;
            
            // ç§»é™¤æç¤ºæ–‡å­—
            if (resultArea.children[0]?.style?.color === '#999') {
                resultArea.innerHTML = '';
            }
            
            // æ·»åŠ åˆ°æœ€å‰é¢
            resultArea.insertBefore(resultCard, resultArea.firstChild);
            
            // é™åˆ¶æœ€å¤šæ˜¾ç¤º5æ¡
            const children = resultArea.children;
            if (children.length > 5) {
                resultArea.removeChild(children[children.length - 1]);
            }
        }
        
        // ç»‘å®šæŠ½å¡æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('drawBtn').addEventListener('click', drawCard);
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®ï¼ˆç©ºæ ¼é”®æŠ½å¡ï¼‰
        document.addEventListener('keydown', function(e) {
            if (e.code === 'Space' && !document.getElementById('drawBtn').disabled) {
                drawCard();
                e.preventDefault(); // é˜²æ­¢ç©ºæ ¼æ»šåŠ¨é¡µé¢
            }
        });
    </script>
</body>
</html>